<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Jmds-svn] r47 - in trunk: .settings applet/de/berlios/jmds/applet/javacard src/de/berlios/jmds src/de/berlios/jmds/applet src/de/berlios/jmds/client src/de/berlios/jmds/common src/de/berlios/jmds/server src/de/berlios/jmds/tools test/de/berlios/jmds/clients
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/jmds-svn/2005-March/index.html" >
   <LINK REL="made" HREF="mailto:jmds-svn%40lists.berlios.de?Subject=Re%3A%20%5BJmds-svn%5D%20r47%20-%20in%20trunk%3A%20.settings%20applet/de/berlios/jmds/applet/javacard%20src/de/berlios/jmds%20src/de/berlios/jmds/applet%20src/de/berlios/jmds/client%20src/de/berlios/jmds/common%20src/de/berlios/jmds/server%20src/de/berlios/jmds/tools%20test/de/berlios/jmds/clients&In-Reply-To=%3C200503020018.j220Inim008443%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000059.html">
   <LINK REL="Next"  HREF="000061.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Jmds-svn] r47 - in trunk: .settings applet/de/berlios/jmds/applet/javacard src/de/berlios/jmds src/de/berlios/jmds/applet src/de/berlios/jmds/client src/de/berlios/jmds/common src/de/berlios/jmds/server src/de/berlios/jmds/tools test/de/berlios/jmds/clients</H1>
    <B>J&#233;r&#244;me GUERS at BerliOS</B> 
    <A HREF="mailto:jmds-svn%40lists.berlios.de?Subject=Re%3A%20%5BJmds-svn%5D%20r47%20-%20in%20trunk%3A%20.settings%20applet/de/berlios/jmds/applet/javacard%20src/de/berlios/jmds%20src/de/berlios/jmds/applet%20src/de/berlios/jmds/client%20src/de/berlios/jmds/common%20src/de/berlios/jmds/server%20src/de/berlios/jmds/tools%20test/de/berlios/jmds/clients&In-Reply-To=%3C200503020018.j220Inim008443%40sheep.berlios.de%3E"
       TITLE="[Jmds-svn] r47 - in trunk: .settings applet/de/berlios/jmds/applet/javacard src/de/berlios/jmds src/de/berlios/jmds/applet src/de/berlios/jmds/client src/de/berlios/jmds/common src/de/berlios/jmds/server src/de/berlios/jmds/tools test/de/berlios/jmds/clients">jguers at sheep.berlios.de
       </A><BR>
    <I>Wed Mar  2 01:18:49 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000059.html">[Jmds-svn] r46 - in trunk: applet/de/berlios/jmds/applet/javacard src/de/berlios/jmds/applet src/de/berlios/jmds/client src/de/berlios/jmds/tools test/de/berlios/jmds/clients
</A></li>
        <LI>Next message: <A HREF="000061.html">[Jmds-svn] Applet fini, mais c'est le d&#233;sert en dehors de la carte !!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60">[ date ]</a>
              <a href="thread.html#60">[ thread ]</a>
              <a href="subject.html#60">[ subject ]</a>
              <a href="author.html#60">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jguers
Date: 2005-03-02 01:18:26 +0100 (Wed, 02 Mar 2005)
New Revision: 47

Added:
   trunk/src/de/berlios/jmds/common/
   trunk/src/de/berlios/jmds/common/AppletManager.java
   trunk/src/de/berlios/jmds/server/UserManagerAppletClient.java
Removed:
   trunk/src/de/berlios/jmds/ior/
Modified:
   trunk/.settings/org.eclipse.jdt.core.prefs
   trunk/applet/de/berlios/jmds/applet/javacard/applet.ijc
   trunk/applet/de/berlios/jmds/applet/javacard/applet.jar
   trunk/applet/de/berlios/jmds/applet/javacard/applet.jca
   trunk/src/de/berlios/jmds/applet/SCApplet.java
   trunk/src/de/berlios/jmds/applet/SCAppletWithKey.java
   trunk/src/de/berlios/jmds/client/ClientInter.java
   trunk/src/de/berlios/jmds/client/ClientORBInitializer.java
   trunk/src/de/berlios/jmds/client/SCAppletClient.java
   trunk/src/de/berlios/jmds/tools/Convertor.java
   trunk/test/de/berlios/jmds/clients/TestSCApllet.java
Log:
Applet avec prise en compte des cles termine
Decryptage difficile sur le serveur. Reste a faire ...

Modified: trunk/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- trunk/.settings/org.eclipse.jdt.core.prefs	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/.settings/org.eclipse.jdt.core.prefs	2005-03-02 00:18:26 UTC (rev 47)
@@ -1,15 +1,50 @@
-#Mon Feb 21 15:53:16 CET 2005
+#Tue Mar 01 21:07:15 CET 2005
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.problem.varargsArgumentNeedCast=warning
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.taskCaseSensitive=enabled
+org.eclipse.jdt.core.compiler.problem.indirectStaticAccess=warning
+org.eclipse.jdt.core.compiler.problem.noImplicitStringConversion=warning
+org.eclipse.jdt.core.compiler.problem.unsafeTypeOperation=warning
+org.eclipse.jdt.core.compiler.problem.specialParameterHidingField=enabled
+org.eclipse.jdt.core.compiler.problem.unusedImport=warning
+org.eclipse.jdt.core.compiler.problem.unqualifiedFieldAccess=ignore
+org.eclipse.jdt.core.compiler.problem.finallyBlockNotCompletingNormally=warning
+org.eclipse.jdt.core.compiler.problem.unusedLocal=warning
+org.eclipse.jdt.core.compiler.problem.undocumentedEmptyBlock=warning
 org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.problem.deprecation=warning
+org.eclipse.jdt.core.compiler.source=1.3
+org.eclipse.jdt.core.compiler.problem.finalParameterBound=ignore
+org.eclipse.jdt.core.compiler.problem.unusedParameter=warning
+org.eclipse.jdt.core.compiler.problem.unnecessaryElse=warning
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
+org.eclipse.jdt.core.compiler.problem.missingSerialVersion=warning
+org.eclipse.jdt.core.compiler.compliance=1.3
 org.eclipse.jdt.core.compiler.taskPriorities=NORMAL,HIGH,LOW,LOW
-org.eclipse.jdt.core.compiler.compliance=1.3
-org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
-org.eclipse.jdt.core.compiler.taskCaseSensitive=enabled
-org.eclipse.jdt.core.compiler.debug.sourceFile=generate
+org.eclipse.jdt.core.compiler.problem.emptyStatement=ignore
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=ignore
+org.eclipse.jdt.core.compiler.problem.unusedParameterWhenImplementingAbstract=disabled
+org.eclipse.jdt.core.compiler.problem.hiddenCatchBlock=warning
+org.eclipse.jdt.core.compiler.problem.incompatibleNonInheritedInterfaceMethod=warning
+org.eclipse.jdt.core.compiler.problem.unusedPrivateMember=warning
+org.eclipse.jdt.core.compiler.problem.unnecessaryTypeCheck=ignore
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=ignore
+org.eclipse.jdt.core.compiler.problem.fieldHiding=warning
+org.eclipse.jdt.core.compiler.problem.possibleAccidentalBooleanAssignment=warning
 org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.1
-org.eclipse.jdt.core.compiler.problem.enumIdentifier=ignore
+org.eclipse.jdt.core.compiler.problem.methodWithConstructorName=warning
+org.eclipse.jdt.core.compiler.problem.deprecationInDeprecatedCode=disabled
+org.eclipse.jdt.core.compiler.problem.overridingPackageDefaultMethod=warning
+org.eclipse.jdt.core.compiler.problem.localVariableHiding=warning
+org.eclipse.jdt.core.compiler.problem.deprecationWhenOverridingDeprecatedMethod=disabled
 eclipse.preferences.version=1
-org.eclipse.jdt.core.compiler.debug.lineNumber=generate
-org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
-org.eclipse.jdt.core.compiler.source=1.3
 org.eclipse.jdt.core.compiler.taskTags=TODO,FIXME,DOCME,AVOIR
-org.eclipse.jdt.core.compiler.problem.assertIdentifier=ignore
+org.eclipse.jdt.core.compiler.problem.syntheticAccessEmulation=ignore
+org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownException=ignore
+org.eclipse.jdt.core.compiler.problem.staticAccessReceiver=warning
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
+org.eclipse.jdt.core.compiler.problem.noEffectAssignment=warning
+org.eclipse.jdt.core.compiler.problem.nonExternalizedStringLiteral=ignore
+org.eclipse.jdt.core.compiler.problem.unusedDeclaredThrownExceptionWhenOverriding=disabled
+org.eclipse.jdt.core.compiler.problem.unusedParameterWhenOverridingConcrete=disabled

Modified: trunk/applet/de/berlios/jmds/applet/javacard/applet.ijc
===================================================================
(Binary files differ)

Modified: trunk/applet/de/berlios/jmds/applet/javacard/applet.jar
===================================================================
(Binary files differ)

Modified: trunk/applet/de/berlios/jmds/applet/javacard/applet.jca
===================================================================
--- trunk/applet/de/berlios/jmds/applet/javacard/applet.jca	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/applet/de/berlios/jmds/applet/javacard/applet.jca	2005-03-02 00:18:26 UTC (rev 47)
@@ -1,5 +1,5 @@
 // converted by version 1.3
-// on Tue Mar 01 10:47:35 CET 2005
+// on Wed Mar 02 01:01:45 CET 2005
 
 .package de/berlios/jmds/applet {
 	.aid 0x11:0x22:0x33:0x44:0x55:0x66;
@@ -13,7 +13,6 @@
 
 	.applet {
 		0x11:0x22:0x33:0x44:0x55:0x66:0x77 SCAppletWithKey;
-		0x11:0x22:0x33:0x44:0x55:0x66:0x88 SCApplet;
 	}
 
 	.constantPool {
@@ -26,15 +25,15 @@
 		// 3
 		instanceFieldRef byte SCApplet/key;
 		// 4
-		instanceFieldRef 1.8 SCAppletWithKey/sessionKey;
+		instanceFieldRef byte[] SCAppletWithKey/userID;
 		// 5
-		instanceFieldRef byte[] SCAppletWithKey/tmpBuff;
+		instanceFieldRef byte[] SCAppletWithKey/sessionKey;
 		// 6
-		instanceFieldRef 1.16 SCAppletWithKey/userKeyPair;
-		// 7
 		instanceFieldRef 1.9 SCAppletWithKey/serverKey;
-		// 8
+		// 7
 		instanceFieldRef 2.1 SCAppletWithKey/cipher;
+		// 8
+		instanceFieldRef 1.14 SCAppletWithKey/random;
 		// 9
 		virtualMethodRef 0.10.1()[B;		// javacard/framework/APDU.getBuffer()[B
 		// 10
@@ -60,65 +59,53 @@
 			.descriptor	Ljavacard/security/RandomData;	1.14;
 
 		// 19
-		classRef 1.16;		// javacard/security/KeyPair
-		// 20
-		staticMethodRef 1.16.0(BS)V;		// javacard/security/KeyPair.&lt;init&gt;(BS)V
-		// 21
-		virtualMethodRef 0.3.1()V;		// javacard/framework/Applet.register()V
-		// 22
-		virtualMethodRef 1.16.1()V;		// javacard/security/KeyPair.genKeyPair()V
-		// 23
 		staticMethodRef 1.13.0(BSZ)Ljavacard/security/Key;;		// javacard/security/KeyBuilder.buildKey(BSZ)Ljavacard/security/Key;
 			.descriptor	Ljavacard/security/Key;	1.0;
 
-		// 24
+		// 20
 		classRef 1.9;		// javacard/security/RSAPublicKey
-		// 25
-		classRef SCApplet;
-		// 26
+		// 21
+		virtualMethodRef 0.3.1()V;		// javacard/framework/Applet.register()V
+		// 22
 		staticMethodRef 2.1.0(BZ)Ljavacardx/crypto/Cipher;;		// javacardx/crypto/Cipher.getInstance(BZ)Ljavacardx/crypto/Cipher;
 			.descriptor	Ljavacardx/crypto/Cipher;	2.1;
 
-		// 27
+		// 23
+		classRef SCApplet;
+		// 24
 		staticMethodRef SCApplet/&lt;init&gt;()V;
-		// 28
+		// 25
 		classRef SCAppletWithKey;
-		// 29
+		// 26
 		staticMethodRef SCAppletWithKey/&lt;init&gt;()V;
-		// 30
+		// 27
 		staticMethodRef SCAppletWithKey/encode(Ljavacard/framework/APDU;)V;
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
-		// 31
-		staticMethodRef SCAppletWithKey/getPubKeyExponentSize(Ljavacard/framework/APDU;)V;
+		// 28
+		staticMethodRef SCAppletWithKey/decode(Ljavacard/framework/APDU;)V;
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
-		// 32
-		staticMethodRef SCAppletWithKey/getPubKeyExponent(Ljavacard/framework/APDU;)V;
+		// 29
+		staticMethodRef SCAppletWithKey/setUserID(Ljavacard/framework/APDU;)V;
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
-		// 33
-		staticMethodRef SCAppletWithKey/getPubKeyModulusSize(Ljavacard/framework/APDU;)V;
+		// 30
+		staticMethodRef SCAppletWithKey/setSeverKeyExp(Ljavacard/framework/APDU;)V;
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
-		// 34
-		staticMethodRef SCAppletWithKey/getPubKeyModulus(Ljavacard/framework/APDU;)V;
+		// 31
+		staticMethodRef SCAppletWithKey/setServerKeyMod(Ljavacard/framework/APDU;)V;
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
-		// 35
-		virtualMethodRef 1.16.2()Ljavacard/security/PrivateKey;;		// javacard/security/KeyPair.getPrivate()Ljavacard/security/PrivateKey;
-			.descriptor	Ljavacard/security/PrivateKey;	1.2;
-
-		// 36
+		// 32
+		classRef 1.0;		// javacard/security/Key
+		// 33
 		virtualMethodRef 2.1.3(Ljavacard/security/Key;B)V;		// javacardx/crypto/Cipher.init(Ljavacard/security/Key;B)V
 			.descriptor	Ljavacard/security/Key;	1.0;
 
-		// 37
+		// 34
 		virtualMethodRef 2.1.1([BSS[BS)S;		// javacardx/crypto/Cipher.doFinal([BSS[BS)S
-		// 38
-		virtualMethodRef 1.16.3()Ljavacard/security/PublicKey;;		// javacard/security/KeyPair.getPublic()Ljavacard/security/PublicKey;
-			.descriptor	Ljavacard/security/PublicKey;	1.3;
-
 	}
 
 	.class public SCApplet 0 extends 0.3 {		// extends javacard/framework/Applet
@@ -130,9 +117,7 @@
 			private byte key 3;		// B
 			private static final byte CLA_SECURITY = 105;		// B
 			private static final byte INS_CODE = 16;		// B
-			private static final byte INS_GET_CODE = 17;		// B
 			private static final byte INS_DECODE = 48;		// B
-			private static final byte INS_GET_DECODE = 51;		// B
 			private static final byte INS_SET_USER_KEY = 119;		// B
 			private static final short BUFFER_LENGTH = 32;		// S
 		}
@@ -181,8 +166,8 @@
 			.stack 1;
 			.locals 0;
 
-				L0:	new 25;		// de/berlios/jmds/applet/SCApplet
-					invokespecial 27;		// de/berlios/jmds/applet/SCApplet.&lt;init&gt;()V
+				L0:	new 23;		// de/berlios/jmds/applet/SCApplet
+					invokespecial 24;		// de/berlios/jmds/applet/SCApplet.&lt;init&gt;()V
 					return;
 		}
 
@@ -274,19 +259,19 @@
 	.class public SCAppletWithKey 1 extends 0.3 {		// extends javacard/framework/Applet
 
 		.fields {
-			private byte[] tmpBuff 0;		// [B
-			private 1.16 userKeyPair 1;		// Ljavacard/security/KeyPair;
-			private 1.9 serverKey 2;		// Ljavacard/security/RSAPublicKey;
-			private 1.8 sessionKey 3;		// Ljavacard/security/RSAPrivateKey;
+			private 1.14 random 0;		// Ljavacard/security/RandomData;
+			private 1.9 serverKey 1;		// Ljavacard/security/RSAPublicKey;
+			private byte[] sessionKey 2;		// [B
+			private byte[] userID 3;		// [B
 			private 2.1 cipher 4;		// Ljavacardx/crypto/Cipher;
 			private static final byte CLA_SECURITY = 105;		// B
 			private static final byte INS_CODE = 16;		// B
 			private static final byte INS_DECODE = 32;		// B
-			private static final byte INS_GETKEY_MOD_SIZE = 64;		// B
-			private static final byte INS_GETKEY_MOD_DATA = 65;		// B
-			private static final byte INS_GETKEY_EXP_SIZE = 66;		// B
-			private static final byte INS_GETKEY_EXP_DATA = 67;		// B
-			private static final short BUFFER_LENGTH = 255;		// S
+			private static final byte INS_SET_USER = 48;		// B
+			private static final byte INS_SET_SERVERKEY_MOD = 68;		// B
+			private static final byte INS_SET_SERVERKEY_EXP = 102;		// B
+			private static final short SESSIONS_KEY_LENGTH = 5;		// S
+			private static final short USER_ID_LENGTH = 10;		// S
 		}
 
 		.publicMethodTable 7 {
@@ -304,40 +289,35 @@
 		}
 
 		.method protected &lt;init&gt;()V 0 {
-			.stack 5;
+			.stack 4;
 			.locals 0;
 
 				L0:	aload_0;
 					invokespecial 17;		// javacard/framework/Applet.&lt;init&gt;()V
 					aload_0;
 					aconst_null;
-					putfield_a 4;		// reference de/berlios/jmds/applet/SCAppletWithKey.sessionKey
+					putfield_a 4;		// reference de/berlios/jmds/applet/SCAppletWithKey.userID
 					aload_0;
-					sspush 256;
+					sconst_5;
 					newarray 11;
-					putfield_a 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.tmpBuff
+					putfield_a 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.sessionKey
 					aload_0;
-					new 19;		// javacard/security/KeyPair
-					dup;
-					sconst_1;
-					sspush 512;
-					invokespecial 20;		// javacard/security/KeyPair.&lt;init&gt;(BS)V
-					putfield_a 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.userKeyPair
-					getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.userKeyPair
-					invokevirtual 22;		// javacard/security/KeyPair.genKeyPair()V
-					aload_0;
 					sconst_4;
 					sspush 512;
 					sconst_1;
-					invokestatic 23;		// javacard/security/KeyBuilder.buildKey(BSZ)Ljavacard/security/Key;
-					checkcast 0 24;		// T_CLASSORINTERFACE javacard/security/RSAPublicKey
-					putfield_a 7;		// reference de/berlios/jmds/applet/SCAppletWithKey.serverKey
+					invokestatic 19;		// javacard/security/KeyBuilder.buildKey(BSZ)Ljavacard/security/Key;
+					checkcast 0 20;		// T_CLASSORINTERFACE javacard/security/RSAPublicKey
+					putfield_a 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.serverKey
 					aload_0;
 					bspush 10;
 					sconst_0;
-					invokestatic 26;		// javacardx/crypto/Cipher.getInstance(BZ)Ljavacardx/crypto/Cipher;
-					putfield_a 8;		// reference de/berlios/jmds/applet/SCAppletWithKey.cipher
+					invokestatic 22;		// javacardx/crypto/Cipher.getInstance(BZ)Ljavacardx/crypto/Cipher;
+					putfield_a 7;		// reference de/berlios/jmds/applet/SCAppletWithKey.cipher
 					aload_0;
+					sconst_2;
+					invokestatic 18;		// javacard/security/RandomData.getInstance(B)Ljavacard/security/RandomData;
+					putfield_a 8;		// reference de/berlios/jmds/applet/SCAppletWithKey.random
+					aload_0;
 					invokevirtual 21;		// javacard/framework/Applet.register()V
 					return;
 		}
@@ -346,8 +326,8 @@
 			.stack 1;
 			.locals 0;
 
-				L0:	new 28;		// de/berlios/jmds/applet/SCAppletWithKey
-					invokespecial 29;		// de/berlios/jmds/applet/SCAppletWithKey.&lt;init&gt;()V
+				L0:	new 25;		// de/berlios/jmds/applet/SCAppletWithKey
+					invokespecial 26;		// de/berlios/jmds/applet/SCAppletWithKey.&lt;init&gt;()V
 					return;
 		}
 
@@ -364,264 +344,266 @@
 					sconst_0;
 					baload;
 					bspush 105;
-					if_scmpne L8;
+					if_scmpne L7;
 				L1:	aload_2;
 					sconst_1;
 					baload;
-					slookupswitch L8 6 16 L2 32 L3 64 L7 65 L6 66 L5 67 L4;
+					slookupswitch L7 5 16 L2 32 L3 48 L4 68 L6 102 L5;
 				L2:	aload_0;
 					aload_1;
-					invokespecial 30;		// de/berlios/jmds/applet/SCAppletWithKey.encode(Ljavacard/framework/APDU;)V
-					goto L8;
-				L3:	goto L8;
+					invokespecial 27;		// de/berlios/jmds/applet/SCAppletWithKey.encode(Ljavacard/framework/APDU;)V
+					goto L7;
+				L3:	aload_0;
+					aload_1;
+					invokespecial 28;		// de/berlios/jmds/applet/SCAppletWithKey.decode(Ljavacard/framework/APDU;)V
+					goto L7;
 				L4:	aload_0;
 					aload_1;
-					invokespecial 31;		// de/berlios/jmds/applet/SCAppletWithKey.getPubKeyExponentSize(Ljavacard/framework/APDU;)V
-					goto L8;
+					invokespecial 29;		// de/berlios/jmds/applet/SCAppletWithKey.setUserID(Ljavacard/framework/APDU;)V
+					goto L7;
 				L5:	aload_0;
 					aload_1;
-					invokespecial 32;		// de/berlios/jmds/applet/SCAppletWithKey.getPubKeyExponent(Ljavacard/framework/APDU;)V
-					goto L8;
+					invokespecial 30;		// de/berlios/jmds/applet/SCAppletWithKey.setSeverKeyExp(Ljavacard/framework/APDU;)V
+					goto L7;
 				L6:	aload_0;
 					aload_1;
-					invokespecial 33;		// de/berlios/jmds/applet/SCAppletWithKey.getPubKeyModulusSize(Ljavacard/framework/APDU;)V
-					goto L8;
-				L7:	aload_0;
-					aload_1;
-					invokespecial 34;		// de/berlios/jmds/applet/SCAppletWithKey.getPubKeyModulus(Ljavacard/framework/APDU;)V
-				L8:	return;
+					invokespecial 31;		// de/berlios/jmds/applet/SCAppletWithKey.setServerKeyMod(Ljavacard/framework/APDU;)V
+				L7:	return;
 		}
 
 		.method private encode(Ljavacard/framework/APDU;)V {
 			.stack 6;
-			.locals 4;
+			.locals 5;
 
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
-				L0:	aload_1;
+				L0:	getfield_a_this 4;		// reference de/berlios/jmds/applet/SCAppletWithKey.userID
+					ifnonnull L2;
+				L1:	sspush 27013;
+					invokestatic 11;		// javacard/framework/ISOException.throwIt(S)V
+				L2:	getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.serverKey
+					invokeinterface 1 32 3;		// javacard/security/Key
+					ifne L4;
+				L3:	sspush 27013;
+					invokestatic 11;		// javacard/framework/ISOException.throwIt(S)V
+				L4:	aload_1;
 					invokevirtual 12;		// javacard/framework/APDU.setIncomingAndReceive()S
 					sstore_2;
 					aload_1;
 					invokevirtual 9;		// javacard/framework/APDU.getBuffer()[B
 					astore_3;
-					getfield_a_this 8;		// reference de/berlios/jmds/applet/SCAppletWithKey.cipher
-					getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.userKeyPair
-					invokevirtual 35;		// javacard/security/KeyPair.getPrivate()Ljavacard/security/PrivateKey;
-					sconst_2;
-					invokevirtual 36;		// javacardx/crypto/Cipher.init(Ljavacard/security/Key;B)V
-					getfield_a_this 8;		// reference de/berlios/jmds/applet/SCAppletWithKey.cipher
+					sload_2;
+					sconst_5;
+					sadd;
+					bspush 10;
+					sadd;
+					newarray 11;
+					astore 4;
+					getfield_a_this 8;		// reference de/berlios/jmds/applet/SCAppletWithKey.random
+					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.sessionKey
+					sconst_0;
+					sconst_5;
+					invokevirtual 13;		// javacard/security/RandomData.generateData([BSS)V
+					sconst_0;
+					sstore 5;
+					goto L6;
+				L5:	aload 4;
+					sload 5;
+					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.sessionKey
+					sload 5;
+					baload;
+					bastore;
+					sinc 5 1;
+				L6:	sload 5;
+					sconst_5;
+					if_scmplt L5;
+				L7:	sconst_0;
+					sstore 5;
+					goto L9;
+				L8:	aload 4;
+					sload 5;
+					sconst_5;
+					sadd;
+					getfield_a_this 4;		// reference de/berlios/jmds/applet/SCAppletWithKey.userID
+					sload 5;
+					baload;
+					bastore;
+					sinc 5 1;
+				L9:	sload 5;
+					bspush 10;
+					if_scmplt L8;
+				L10:	sconst_0;
+					sstore 5;
+					goto L12;
+				L11:	aload 4;
+					sload 5;
+					sconst_5;
+					sadd;
+					bspush 10;
+					sadd;
 					aload_3;
+					sload 5;
 					sconst_5;
+					sadd;
+					baload;
+					bastore;
+					sinc 5 1;
+				L12:	sload 5;
 					sload_2;
-					aload_3;
+					if_scmplt L11;
+				L13:	getfield_a_this 7;		// reference de/berlios/jmds/applet/SCAppletWithKey.cipher
+					getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.serverKey
+					sconst_2;
+					invokevirtual 33;		// javacardx/crypto/Cipher.init(Ljavacard/security/Key;B)V
+					getfield_a_this 7;		// reference de/berlios/jmds/applet/SCAppletWithKey.cipher
+					aload 4;
+					sconst_0;
+					sload_2;
 					sconst_5;
-					invokevirtual 37;		// javacardx/crypto/Cipher.doFinal([BSS[BS)S
-					sstore 4;
+					sadd;
+					bspush 10;
+					sadd;
+					aload 4;
+					sconst_0;
+					invokevirtual 34;		// javacardx/crypto/Cipher.doFinal([BSS[BS)S
+					sstore 5;
 					aload_1;
 					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					sstore 5;
+					sstore 6;
+					sload 6;
 					sload 5;
-					sload 4;
-					if_scmpge L2;
-				L1:	sspush 26368;
+					if_scmpge L15;
+				L14:	sspush 26368;
 					invokestatic 11;		// javacard/framework/ISOException.throwIt(S)V
-				L2:	aload_1;
-					sload 4;
+				L15:	aload_1;
+					sload 5;
 					invokevirtual 15;		// javacard/framework/APDU.setOutgoingLength(S)V
 					aload_1;
-					aload_3;
-					sconst_5;
-					sload 4;
+					aload 4;
+					sconst_0;
+					sload 5;
 					invokevirtual 16;		// javacard/framework/APDU.sendBytesLong([BSS)V
 					return;
 		}
 
-		.method private getPubKeyModulusSize(Ljavacard/framework/APDU;)V {
-			.stack 4;
-			.locals 4;
+		.method private decode(Ljavacard/framework/APDU;)V {
+			.stack 5;
+			.locals 5;
 
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
 				L0:	aload_1;
 					invokevirtual 12;		// javacard/framework/APDU.setIncomingAndReceive()S
-					pop;
+					sstore_2;
 					aload_1;
 					invokevirtual 9;		// javacard/framework/APDU.getBuffer()[B
-					astore_2;
-					aload_1;
-					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					sstore_3;
-					sload_3;
-					sconst_2;
-					if_scmpge L2;
-				L1:	sspush 26368;
-					invokestatic 11;		// javacard/framework/ISOException.throwIt(S)V
-				L2:	getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.userKeyPair
-					invokevirtual 38;		// javacard/security/KeyPair.getPublic()Ljavacard/security/PublicKey;
-					checkcast 0 24;		// T_CLASSORINTERFACE javacard/security/RSAPublicKey
-					astore 4;
-					aload 4;
-					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.tmpBuff
+					astore_3;
 					sconst_0;
-					invokeinterface 3 24 5;		// javacard/security/RSAPublicKey
-					sstore 5;
-					aload_2;
+					sstore 4;
+					sload_2;
+					newarray 11;
+					astore 5;
 					sconst_0;
-					sload 5;
-					sspush 256;
-					sdiv;
-					s2b;
+					sstore 6;
+					goto L2;
+				L1:	aload 5;
+					sload 6;
+					aload_3;
+					sload 6;
+					sconst_5;
+					sadd;
+					baload;
+					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.sessionKey
+					sload 4;
+					baload;
+					sxor;
 					bastore;
-					aload_2;
+					sload 4;
 					sconst_1;
-					sload 5;
-					sspush 256;
+					sadd;
+					sconst_5;
 					srem;
-					s2b;
-					bastore;
-					aload_1;
-					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					pop;
-					aload_1;
-					sconst_2;
-					invokevirtual 15;		// javacard/framework/APDU.setOutgoingLength(S)V
-					aload_1;
-					aload_2;
-					sconst_0;
-					sconst_2;
-					invokevirtual 16;		// javacard/framework/APDU.sendBytesLong([BSS)V
-					return;
+					sstore 4;
+					sinc 6 1;
+				L2:	sload 6;
+					sload_2;
+					if_scmplt L1;
+				L3:	return;
 		}
 
-		.method private getPubKeyModulus(Ljavacard/framework/APDU;)V {
+		.method private setServerKeyMod(Ljavacard/framework/APDU;)V {
 			.stack 4;
-			.locals 3;
+			.locals 2;
 
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
-				L0:	getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.userKeyPair
-					invokevirtual 38;		// javacard/security/KeyPair.getPublic()Ljavacard/security/PublicKey;
-					checkcast 0 24;		// T_CLASSORINTERFACE javacard/security/RSAPublicKey
-					astore_2;
-					aload_2;
-					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.tmpBuff
-					sconst_0;
-					invokeinterface 3 24 5;		// javacard/security/RSAPublicKey
-					sstore_3;
+				L0:	aload_1;
+					invokevirtual 12;		// javacard/framework/APDU.setIncomingAndReceive()S
+					sstore_2;
 					aload_1;
-					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					sstore 4;
-					sload 4;
-					sload_3;
-					if_scmpge L2;
-				L1:	sspush 26368;
-					invokestatic 11;		// javacard/framework/ISOException.throwIt(S)V
-				L2:	aload_1;
-					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					pop;
-					aload_1;
-					sload_3;
-					invokevirtual 15;		// javacard/framework/APDU.setOutgoingLength(S)V
-					aload_1;
-					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.tmpBuff
-					sconst_0;
-					sload_3;
-					invokevirtual 16;		// javacard/framework/APDU.sendBytesLong([BSS)V
+					invokevirtual 9;		// javacard/framework/APDU.getBuffer()[B
+					astore_3;
+					getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.serverKey
+					aload_3;
+					sconst_5;
+					sload_2;
+					invokeinterface 4 20 7;		// javacard/security/RSAPublicKey
 					return;
 		}
 
-		.method private getPubKeyExponentSize(Ljavacard/framework/APDU;)V {
+		.method private setSeverKeyExp(Ljavacard/framework/APDU;)V {
 			.stack 4;
-			.locals 4;
+			.locals 2;
 
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
 				L0:	aload_1;
 					invokevirtual 12;		// javacard/framework/APDU.setIncomingAndReceive()S
-					pop;
+					sstore_2;
 					aload_1;
 					invokevirtual 9;		// javacard/framework/APDU.getBuffer()[B
-					astore_2;
-					aload_1;
-					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					sstore_3;
-					sload_3;
-					sconst_2;
-					if_scmpge L2;
-				L1:	sspush 26368;
-					invokestatic 11;		// javacard/framework/ISOException.throwIt(S)V
-				L2:	getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.userKeyPair
-					invokevirtual 38;		// javacard/security/KeyPair.getPublic()Ljavacard/security/PublicKey;
-					checkcast 0 24;		// T_CLASSORINTERFACE javacard/security/RSAPublicKey
-					astore 4;
-					aload 4;
-					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.tmpBuff
-					sconst_0;
-					invokeinterface 3 24 4;		// javacard/security/RSAPublicKey
-					sstore 5;
-					aload_2;
-					sconst_0;
-					sload 5;
-					sspush 256;
-					sdiv;
-					s2b;
-					bastore;
-					aload_2;
-					sconst_1;
-					sload 5;
-					sspush 256;
-					srem;
-					s2b;
-					bastore;
-					aload_1;
-					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					pop;
-					aload_1;
-					sconst_2;
-					invokevirtual 15;		// javacard/framework/APDU.setOutgoingLength(S)V
-					aload_1;
-					aload_2;
-					sconst_0;
-					sconst_2;
-					invokevirtual 16;		// javacard/framework/APDU.sendBytesLong([BSS)V
+					astore_3;
+					getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.serverKey
+					aload_3;
+					sconst_5;
+					sload_2;
+					invokeinterface 4 20 6;		// javacard/security/RSAPublicKey
 					return;
 		}
 
-		.method private getPubKeyExponent(Ljavacard/framework/APDU;)V {
-			.stack 4;
+		.method private setUserID(Ljavacard/framework/APDU;)V {
+			.stack 5;
 			.locals 3;
 
 			.descriptor	Ljavacard/framework/APDU;	0.10;
 
-				L0:	getfield_a_this 6;		// reference de/berlios/jmds/applet/SCAppletWithKey.userKeyPair
-					invokevirtual 38;		// javacard/security/KeyPair.getPublic()Ljavacard/security/PublicKey;
-					checkcast 0 24;		// T_CLASSORINTERFACE javacard/security/RSAPublicKey
-					astore_2;
-					aload_2;
-					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.tmpBuff
-					sconst_0;
-					invokeinterface 3 24 4;		// javacard/security/RSAPublicKey
-					sstore_3;
+				L0:	aload_1;
+					invokevirtual 12;		// javacard/framework/APDU.setIncomingAndReceive()S
+					sstore_2;
 					aload_1;
-					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					sstore 4;
-					sload 4;
-					sload_3;
-					if_scmpge L2;
+					invokevirtual 9;		// javacard/framework/APDU.getBuffer()[B
+					astore_3;
+					sload_2;
+					bspush 10;
+					if_scmpeq L2;
 				L1:	sspush 26368;
 					invokestatic 11;		// javacard/framework/ISOException.throwIt(S)V
-				L2:	aload_1;
-					invokevirtual 14;		// javacard/framework/APDU.setOutgoing()S
-					pop;
-					aload_1;
-					sload_3;
-					invokevirtual 15;		// javacard/framework/APDU.setOutgoingLength(S)V
-					aload_1;
-					getfield_a_this 5;		// reference de/berlios/jmds/applet/SCAppletWithKey.tmpBuff
-					sconst_0;
-					sload_3;
-					invokevirtual 16;		// javacard/framework/APDU.sendBytesLong([BSS)V
-					return;
+				L2:	sconst_0;
+					sstore 4;
+					goto L4;
+				L3:	getfield_a_this 4;		// reference de/berlios/jmds/applet/SCAppletWithKey.userID
+					sload 4;
+					aload_3;
+					sconst_5;
+					sload 4;
+					sadd;
+					baload;
+					bastore;
+					sinc 4 1;
+				L4:	sload 4;
+					sload_2;
+					if_scmplt L3;
+				L5:	return;
 		}
 
 	}

Modified: trunk/src/de/berlios/jmds/applet/SCApplet.java
===================================================================
--- trunk/src/de/berlios/jmds/applet/SCApplet.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/src/de/berlios/jmds/applet/SCApplet.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -23,9 +23,7 @@
     private final static byte CLA_SECURITY = (byte) 0x69;
     
     private final static byte INS_CODE = (byte) 0x10;
-    private final static byte INS_GET_CODE = (byte) 0x11;
     private final static byte INS_DECODE = (byte) 0x30;
-    private final static byte INS_GET_DECODE = (byte) 0x33;
     private final static byte INS_SET_USER_KEY = (byte) 0x77;
     
     private final static short BUFFER_LENGTH = (short) 0x20;

Modified: trunk/src/de/berlios/jmds/applet/SCAppletWithKey.java
===================================================================
--- trunk/src/de/berlios/jmds/applet/SCAppletWithKey.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/src/de/berlios/jmds/applet/SCAppletWithKey.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -10,9 +10,8 @@
 import javacard.framework.ISOException;
 import javacard.framework.ISO7816;
 import javacard.security.KeyBuilder;
-import javacard.security.KeyPair;
-import javacard.security.RSAPrivateKey;
 import javacard.security.RSAPublicKey;
+import javacard.security.RandomData;
 import javacardx.crypto.Cipher;
 
 /**
@@ -25,34 +24,31 @@
 public class SCAppletWithKey extends Applet {
 
     private final static byte CLA_SECURITY = (byte) 0x69;
+    
     private final static byte INS_CODE = (byte) 0x10;
     private final static byte INS_DECODE = (byte) 0x20;
+    private final static byte INS_SET_USER = (byte) 0x30;
+    private final static byte INS_SET_SERVERKEY_MOD = (byte) 0x44;
+    private final static byte INS_SET_SERVERKEY_EXP = (byte) 0x66;
     
-    private final static byte INS_GETKEY_MOD_SIZE = (byte) 0x40;
-    private final static byte INS_GETKEY_MOD_DATA = (byte) 0x41;
-    private final static byte INS_GETKEY_EXP_SIZE = (byte) 0x42;
-    private final static byte INS_GETKEY_EXP_DATA = (byte) 0x43;
+    private final static short SESSIONS_KEY_LENGTH = (short) 5;
+    private final static short USER_ID_LENGTH = (short) 10;
 
-    private final static short BUFFER_LENGTH = (short) 255;
-
-    private byte[] tmpBuff;
-    
-    private KeyPair userKeyPair;
+    private RandomData random;
     private RSAPublicKey serverKey;
-    private RSAPrivateKey sessionKey = null;
+    private byte[] sessionKey;
+    private byte[] userID = null;
     private Cipher cipher;
     
     /**
      * Constructeur par d&#233;faut
      */
     protected SCAppletWithKey() {
-        tmpBuff = new byte[256];
+        sessionKey = new byte[SESSIONS_KEY_LENGTH];
         
-        userKeyPair = new KeyPair( KeyPair.ALG_RSA, KeyBuilder.LENGTH_RSA_512);
-        userKeyPair.genKeyPair();
         serverKey = (RSAPublicKey) KeyBuilder.buildKey(KeyBuilder.TYPE_RSA_PUBLIC, KeyBuilder.LENGTH_RSA_512, true);
-
         cipher = Cipher.getInstance(Cipher.ALG_RSA_PKCS1, false);
+        random = RandomData.getInstance(RandomData.ALG_SECURE_RANDOM);
         register();
     }
 
@@ -77,117 +73,105 @@
         if (inBuffer[ISO7816.OFFSET_CLA] == CLA_SECURITY) {
             switch (inBuffer[ISO7816.OFFSET_INS]) {
                 case INS_CODE: encode(apdu); break;
-                case INS_DECODE: break;
+                case INS_DECODE: decode(apdu); break;
                     
-                case INS_GETKEY_EXP_DATA : getPubKeyExponentSize(apdu); break;
-                case INS_GETKEY_EXP_SIZE : getPubKeyExponent(apdu); break;
-                case INS_GETKEY_MOD_DATA : getPubKeyModulusSize(apdu); break;
-                case INS_GETKEY_MOD_SIZE : getPubKeyModulus(apdu); break;
+                case INS_SET_USER : setUserID(apdu); break;
+                case INS_SET_SERVERKEY_EXP : setSeverKeyExp(apdu); break;
+                case INS_SET_SERVERKEY_MOD : setServerKeyMod(apdu); break;
             }
         }
     }
     
     private void encode(APDU apdu)
     {
+        if(userID == null)
+            ISOException.throwIt(ISO7816.SW_CONDITIONS_NOT_SATISFIED);
+        if(!serverKey.isInitialized())
+            ISOException.throwIt(ISO7816.SW_CONDITIONS_NOT_SATISFIED);
+        
         short byteRead = apdu.setIncomingAndReceive();
         byte[] inBuffer = apdu.getBuffer();
+        byte[] code = new byte[(short)(byteRead + SESSIONS_KEY_LENGTH + USER_ID_LENGTH)];
         
-        cipher.init(userKeyPair.getPrivate(), Cipher.MODE_ENCRYPT);
-        short outbytes = cipher.doFinal(inBuffer,(short)ISO7816.OFFSET_CDATA, byteRead, inBuffer, (short)ISO7816.OFFSET_CDATA);    
+        random.generateData(sessionKey, (short)0, SESSIONS_KEY_LENGTH);
         
+        for (short i = 0; i &lt; SESSIONS_KEY_LENGTH; i++) {
+            code[i] = sessionKey[i];
+        }
+
+        for (short i = 0; i &lt; USER_ID_LENGTH; i++) {
+            code[(short)(i + SESSIONS_KEY_LENGTH)] = userID[i];
+        }
+
+        for (short i = 0; i &lt; byteRead; i++) {
+            code[(short)(i + SESSIONS_KEY_LENGTH + USER_ID_LENGTH)] = inBuffer[(short) (i + ISO7816.OFFSET_CDATA)];
+        }
+        
+        cipher.init(serverKey, Cipher.MODE_ENCRYPT);
+        short byteWrite = cipher.doFinal(code, (short)0, (short) (byteRead + SESSIONS_KEY_LENGTH + USER_ID_LENGTH), code, (short)0);
+        
         // Send results
         short Le = apdu.setOutgoing();
-        if (Le &lt; outbytes)
+        if (Le &lt; byteWrite)
             ISOException.throwIt(ISO7816.SW_WRONG_LENGTH);
 
         // indicate the number of bytes in the data field
-        apdu.setOutgoingLength(outbytes); 
+        apdu.setOutgoingLength(byteWrite); 
         // at offset 0 send 128 byte of data in the buffer
-        apdu.sendBytesLong(inBuffer, (short)ISO7816.OFFSET_CDATA, (short)outbytes);
-        
-//        messLength = apdu.setIncomingAndReceive();
-//        RSAPublicKey pubKey = (RSAPublicKey) userKeyPair.getPublic();
-//        short modSize = pubKey.getModulus(tmpBuff, (short) 0);
-//        short expSize = pubKey.getExponent(tmpBuff, (short) 0);
-//        byte[] code = new byte[messLength + modSize + expSize];
-//        for (short i = 0; i &lt; messLength; i++) {
-//            code[i] = buffer[(short) (i + ISO7816.OFFSET_CDATA)];
-//        }
-//        modSize = pubKey.getModulus(tmpBuff, (short) 0);
-//        for (short i = 0; i &lt; modSize; i++) {
-//            code[i + messLength] = tmpBuff[i];
-//        }
-//        expSize = pubKey.getExponent(tmpBuff, (short) 0);
-//        for (short i = 0; i &lt; expSize; i++) {
-//            code[i + messLength + modSize] = tmpBuff[i];
-//        }
-//        cipher.init(userKeyPair.getPrivate(), Cipher.MODE_ENCRYPT);
-//        cipher.doFinal(code, (short)0, (short) (messLength + modSize + expSize), code, (short)0);
+        apdu.sendBytesLong(code, (short)0, (short)byteWrite);
     }
     
-    ////////////////////////////////////////////////////////////////////////////////
-    //                    Public-Key-Transfer                                     //
-    ////////////////////////////////////////////////////////////////////////////////
-    private void getPubKeyModulusSize( APDU apdu ) {
-        apdu.setIncomingAndReceive();
+    private void decode(APDU apdu)
+    {
+        short byteRead = apdu.setIncomingAndReceive();
         byte[] inBuffer = apdu.getBuffer();
-        // Send results
-        short Le = apdu.setOutgoing();
-        if (Le &lt; (short) 2)
-            ISOException.throwIt(ISO7816.SW_WRONG_LENGTH);
-        
-        RSAPublicKey pubKey = (RSAPublicKey) userKeyPair.getPublic();
-        short keySize = pubKey.getModulus( tmpBuff,(short) 0);
-        inBuffer[ (byte)0 ] = (byte) (keySize / 256 );
-        inBuffer[ (byte)1 ] = (byte) (keySize % 256 );
-        apdu.setOutgoing();
-        apdu.setOutgoingLength( (byte) 2 );
-        apdu.sendBytesLong( inBuffer, (short) 0, (short) 2 );
-    }
-    
-    private void getPubKeyModulus( APDU apdu ) {
-        RSAPublicKey pubKey = (RSAPublicKey) userKeyPair.getPublic();
-        short keySize = pubKey.getModulus( tmpBuff,(short) 0);
-        
-        // Send results
-        short Le = apdu.setOutgoing();
-        if (Le &lt; keySize)
-            ISOException.throwIt(ISO7816.SW_WRONG_LENGTH);
 
-        apdu.setOutgoing();
-        apdu.setOutgoingLength( keySize );
-        apdu.sendBytesLong( tmpBuff, (short) 0, keySize );
+        short cleInd = 0;
+        byte []resByte = new byte[byteRead];
+        for(short i = 0 ; i &lt; byteRead ; i++ ) {
+            resByte[i] = (byte)(inBuffer[(short)(i + ISO7816.OFFSET_CDATA)] ^ sessionKey[cleInd]);
+            cleInd = (short)(((short)(cleInd + 1)) % SESSIONS_KEY_LENGTH);
+        }
     }
-    
-    private void getPubKeyExponentSize( APDU apdu ) {
-        apdu.setIncomingAndReceive();
+
+    /** 
+     * DOCME
+     *
+     * @param apdu 
+     */
+    private void setServerKeyMod(APDU apdu) {
+        short byteRead = apdu.setIncomingAndReceive();
         byte[] inBuffer = apdu.getBuffer();
+        
+        serverKey.setModulus(inBuffer, ISO7816.OFFSET_CDATA, byteRead);
+    }
 
-        // Send results
-        short Le = apdu.setOutgoing();
-        if (Le &lt; (short) 2)
-            ISOException.throwIt(ISO7816.SW_WRONG_LENGTH);
-
-        RSAPublicKey pubKey = (RSAPublicKey) userKeyPair.getPublic();
-        short keySize = pubKey.getExponent(tmpBuff,(short) 0);
-        inBuffer[ (byte)0 ] = (byte) (keySize / 256 );
-        inBuffer[ (byte)1 ] = (byte) (keySize % 256 );
-        apdu.setOutgoing();
-        apdu.setOutgoingLength( (byte) 2 );
-        apdu.sendBytesLong( inBuffer, (short) 0, (short) 2 );
+    /** 
+     * DOCME
+     * 
+     * @param apdu 
+     */
+    private void setSeverKeyExp(APDU apdu) {
+        short byteRead = apdu.setIncomingAndReceive();
+        byte[] inBuffer = apdu.getBuffer();
+        
+        serverKey.setExponent(inBuffer, ISO7816.OFFSET_CDATA, byteRead);
     }
-    
-    private void getPubKeyExponent( APDU apdu ) {
-        RSAPublicKey pubKey = (RSAPublicKey) userKeyPair.getPublic();
-        short keySize = pubKey.getExponent( tmpBuff,(short) 0);
+
+    /** 
+     * DOCME
+     *
+     * @param apdu 
+     */
+    private void setUserID(APDU apdu) {
+        short byteRead = apdu.setIncomingAndReceive();
+        byte[] inBuffer = apdu.getBuffer();
         
-        // Send results
-        short Le = apdu.setOutgoing();
-        if (Le &lt; keySize)
+        if(byteRead != USER_ID_LENGTH)
             ISOException.throwIt(ISO7816.SW_WRONG_LENGTH);
-
-        apdu.setOutgoing();
-        apdu.setOutgoingLength( keySize );
-        apdu.sendBytesLong( tmpBuff, (short) 0, keySize );
+        
+        for (short i = 0; i &lt; byteRead; i++) {
+            userID[i] = inBuffer[(short)(ISO7816.OFFSET_CDATA + i)];
+        }
     }
 }

Modified: trunk/src/de/berlios/jmds/client/ClientInter.java
===================================================================
--- trunk/src/de/berlios/jmds/client/ClientInter.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/src/de/berlios/jmds/client/ClientInter.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -27,7 +27,6 @@
      * Comment for &lt;code&gt;serialVersionUID&lt;/code&gt;
      */
     private final static long serialVersionUID = 3618417146430765111L;
-    private final static SCAppletClient SC_APPLET = SCAppletClient.getInstance();
 
     //----------------------------------------------------------//
 	//------------------- PUBLIC METHODS -----------------------//
@@ -43,7 +42,7 @@
         byte[] tabId = Integer.toString(id).getBytes();
 
         try {
-            byte[] tabByteSC = SC_APPLET.code(tabId);
+            byte[] tabByteSC = SCAppletClient.code(tabId);
             
             ServiceContext sc = new ServiceContext ();
             sc.context_data = tabByteSC;
@@ -94,6 +93,5 @@
     /**
      * @see org.omg.PortableInterceptor.InterceptorOperations#destroy()
      */
-    public void destroy() {
-    }
+    public void destroy() {}
 }

Modified: trunk/src/de/berlios/jmds/client/ClientORBInitializer.java
===================================================================
--- trunk/src/de/berlios/jmds/client/ClientORBInitializer.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/src/de/berlios/jmds/client/ClientORBInitializer.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -33,14 +33,14 @@
      * @see org.omg.PortableInterceptor.ORBInitializerOperations#pre_init(org.omg.PortableInterceptor.ORBInitInfo)
      */
     public void pre_init(ORBInitInfo info) {
-        System.out.println(&quot;MonORBInitializer.pre_init: ORB ID: &quot; + info);
+        System.out.println(&quot;MonORBInitializer.pre_init: ORB ID: &quot; + info.orb_id());
     }
 
     /**
      * @see org.omg.PortableInterceptor.ORBInitializerOperations#post_init(org.omg.PortableInterceptor.ORBInitInfo)
      */
     public void post_init(ORBInitInfo info) {
-        System.out.println(&quot;MonORBInitializer.post_init: ORB ID: &quot; + info);
+        System.out.println(&quot;MonORBInitializer.post_init: ORB ID: &quot; + info.orb_id());
         ClientInter client = new ClientInter();
         try {
             info.add_client_request_interceptor(client);

Modified: trunk/src/de/berlios/jmds/client/SCAppletClient.java
===================================================================
--- trunk/src/de/berlios/jmds/client/SCAppletClient.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/src/de/berlios/jmds/client/SCAppletClient.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -10,11 +10,8 @@
 
 package de.berlios.jmds.client;
 
+import de.berlios.jmds.common.AppletManager;
 import de.berlios.jmds.tools.Convertor;
-import slb.iop.IOP;
-import slb.iop.IOPEvent;
-import slb.iop.IOPListener;
-import slb.iop.SmartCard;
 import slb.iop.slbException;
 
 /**
@@ -23,82 +20,23 @@
  */
 public class SCAppletClient {
 
-    /** The singleton instance * */
-    private static SCAppletClient INSTANCE;
-    private static IOP APPLET_IOP;
-
-    private final static short[] APPLET_AID = {
-            (short) 0x11, (short) 0x22, (short) 0x33, 
-            (short) 0x44, (short) 0x55, (short) 0x66, (short) 0x77 };
-    
     private final static byte CLA_SECURITY = (byte) 0x69;
     private final static byte INS_CODE = (byte) 0x10;
     private final static byte INS_DECODE = (byte) 0x20;
     
-    private final static byte INS_GETKEY_MOD_SIZE = (byte) 0x40;
-    private final static byte INS_GETKEY_MOD_DATA = (byte) 0x41;
-    private final static byte INS_GETKEY_EXP_SIZE = (byte) 0x42;
-    private final static byte INS_GETKEY_EXP_DATA = (byte) 0x43;
-
-    private static SmartCard card = null;
-
-    private static class jmdsIOPListener implements IOPListener {
-        public void CardRemoved(IOPEvent event) {
-            findCard();
-        }
-
-        public void CardInserted(IOPEvent event) {
-            findCard();
-        }
-
-        public void ReaderRemoved(IOPEvent event) {
-            findCard();
-        }
-
-        public void ReaderInserted(IOPEvent event) {
-            findCard();
-        }
-    }
-
     // ----------------------------------------------------------//
-    // ------------------- CONSTRUCTORS -------------------------//
-    // ----------------------------------------------------------//
-    /**
-     * Constructor
-     * 
-     */
-    private SCAppletClient() {
-        APPLET_IOP.addIOPListener(new jmdsIOPListener());
-    }
-
-    // ----------------------------------------------------------//
     // ------------------- PUBLIC METHODS -----------------------//
     // ----------------------------------------------------------//
     /**
-     * To get the singleton instance of LDAP
-     * 
-     * @return the singleton instance of LDAP
-     */
-    public static SCAppletClient getInstance() {
-        if(INSTANCE == null)
-        {
-            APPLET_IOP = new IOP();
-            INSTANCE = new SCAppletClient();
-            findCard();
-        }
-        return INSTANCE;
-    }
-
-    /**
      * @param requestId
      *            as id of the request message
      * @return The array byte which contains the encoding servec context
      * @throws slbException 
      * @throws SecurityException 
      */
-    public byte[] code(byte[] requestId) throws SecurityException, slbException {
+    public static byte[] code(byte[] requestId) throws SecurityException, slbException {
         int[] body = Convertor.stringToIntArray(&quot;555555&quot;);
-        byte[] code = Convertor.shortArrayToByteArray(sendCardAPDU(card, CLA_SECURITY, INS_CODE, 0, 0, body, 0x40));
+        byte[] code = Convertor.shortArrayToByteArray(AppletManager.sendCardAPDU(CLA_SECURITY, INS_CODE, 0, 0, body, 0x40));
         return code;
     }
 
@@ -109,94 +47,9 @@
      * @throws slbException 
      * @throws SecurityException 
      */
-    public byte[] decode(byte[] SC) throws SecurityException, slbException {
+    public static byte[] decode(byte[] SC) throws SecurityException, slbException {
         int[] body = Convertor.stringToIntArray(&quot;555555&quot;);
-        byte[] decode = Convertor.shortArrayToByteArray(sendCardAPDU(card, CLA_SECURITY, INS_DECODE, 0, 0, body, 0x40));
+        byte[] decode = Convertor.shortArrayToByteArray(AppletManager.sendCardAPDU(CLA_SECURITY, INS_DECODE, 0, 0, body, 0x40));
         return decode;
     }
-    
-    /**
-     * @param card
-     * @param LE
-     * @param body
-     * @param P2
-     * @param P1
-     * @param INS
-     * @param CLA
-     * @return out the result of the sendCardAPDU call
-     * @throws slbException
-     * 
-     */
-    private final static short[] sendCardAPDU(SmartCard card, int CLA, int INS,
-            int P1, int P2, int[] body, int LE) throws slbException,
-            SecurityException {
-        if (card == null)
-            throw new SecurityException(&quot;Pas de carte disponible !&quot;);
-
-        // Initialisation
-        card.BeginTransaction();
-        if (!card.SelectAID(APPLET_AID)) // A v&#233;rifier. Je ne sais pas si &#231;a marche !!
-            throw new SecurityException(&quot;Pas d'applet de cryptage !&quot;);
-        
-        short[] out = card.SendCardAPDU(CLA, INS, P1, P2, body, LE);
-        card.EndTransaction();
-        if (out == null)
-            out = new short[0];
-        return out;
-    }
-    
-    /**
-     * Recherche d'une carte ayant notre applet instanci&#233;
-     */
-    private final static void findCard()
-    {
-        String[] lstReaders = APPLET_IOP.ListReaders();
-        int i = 0;
-        while ((i &lt; lstReaders.length) &amp;&amp; (card == null)) {
-            card = new SmartCard();
-            System.out.println(lstReaders[i]);
-            boolean result = APPLET_IOP.Connect(card, lstReaders[i], false);
-            if (result) {
-                short[] MACKey = Convertor.HexStringToShortArray(&quot;404142434445464748494A4B4C4D4E4F&quot;);
-                short[] autKey = Convertor.HexStringToShortArray(&quot;404142434445464748494A4B4C4D4E4F&quot;);
-                short[] KEKKey = Convertor.HexStringToShortArray(&quot;404142434445464748494A4B4C4D4E4F&quot;);
-
-                try {
-                    card.BeginTransaction();
-                    card.EstablishSecureChannel(MACKey, autKey, KEKKey);
-                    short shortAID[] = card.EnumerateAID((byte) 0x40);
-
-                    short[] shortListAID;
-
-                    int z = 0;
-                    for (int y = 0; y &lt; shortAID.length; y = z) {
-                        shortListAID = new short[shortAID[y]];
-                        z = z + shortListAID.length + 3;
-                        for (int x = 0; x &lt; shortListAID.length; x++) {
-                            shortListAID[x] = shortAID[x + y + 1];
-                        }
-
-                        if ((shortAID[z - 1] &amp; (byte) 0x80) != 1) {
-                            boolean equals = (APPLET_AID.length == shortListAID.length);
-                            for (int j = 0; j &lt; shortListAID.length &amp;&amp; equals == true; j++) {
-                                if(APPLET_AID[j] != shortListAID[j])
-                                    equals = false;
-                            }
-                            if(!equals)
-                            {
-                                card.EndTransaction();
-                                card = null;
-                            }
-                        }
-                    }
-                    if(card != null)
-                        card.EndTransaction();
-                } catch (slbException e) {
-                    card = null;
-                }
-            } else
-                card = null;
-            i++;
-        }
-    }
 }

Added: trunk/src/de/berlios/jmds/common/AppletManager.java
===================================================================
--- trunk/src/de/berlios/jmds/common/AppletManager.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/src/de/berlios/jmds/common/AppletManager.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -0,0 +1,138 @@
+/*
+ * Created on 1 mars 2005
+ * by J&#233;r&#244;me GUERS
+ * Copyright: GPL - UMLV(FR) - 2004/2005
+ */
+package de.berlios.jmds.common;
+
+import de.berlios.jmds.tools.Convertor;
+import slb.iop.IOP;
+import slb.iop.IOPEvent;
+import slb.iop.IOPListener;
+import slb.iop.SmartCard;
+import slb.iop.slbException;
+
+/**
+ * DOCME
+ * 
+ * @author J&#233;r&#244;me GUERS
+ */
+public class AppletManager {
+    
+    private static IOP APPLET_IOP;
+    private static SmartCard card = null;
+    
+    public final static short[] APPLET_AID = {
+        (short) 0x11, (short) 0x22, (short) 0x33, 
+        (short) 0x44, (short) 0x55, (short) 0x66, (short) 0x77 };
+    
+    
+    private static class jmdsIOPListener implements IOPListener {
+        public void CardRemoved(IOPEvent event) {
+            findCard();
+        }
+
+        public void CardInserted(IOPEvent event) {
+            findCard();
+        }
+
+        public void ReaderRemoved(IOPEvent event) {
+            findCard();
+        }
+
+        public void ReaderInserted(IOPEvent event) {
+            findCard();
+        }
+    }
+
+    static {
+        APPLET_IOP = new IOP();
+        APPLET_IOP.addIOPListener(new jmdsIOPListener());
+        findCard();
+    }
+
+    /**
+     * Recherche d'une carte ayant notre applet instanci&#233;
+     */
+    public final static void findCard()
+    {
+        String[] lstReaders = APPLET_IOP.ListReaders();
+        int i = 0;
+        while ((i &lt; lstReaders.length) &amp;&amp; (card == null)) {
+            card = new SmartCard();
+            System.out.println(lstReaders[i]);
+            boolean result = APPLET_IOP.Connect(card, lstReaders[i], false);
+            if (result) {
+                short[] MACKey = Convertor.HexStringToShortArray(&quot;404142434445464748494A4B4C4D4E4F&quot;);
+                short[] autKey = Convertor.HexStringToShortArray(&quot;404142434445464748494A4B4C4D4E4F&quot;);
+                short[] KEKKey = Convertor.HexStringToShortArray(&quot;404142434445464748494A4B4C4D4E4F&quot;);
+
+                try {
+                    card.BeginTransaction();
+                    card.EstablishSecureChannel(MACKey, autKey, KEKKey);
+                    short shortAID[] = card.EnumerateAID((byte) 0x40);
+
+                    short[] shortListAID;
+
+                    int z = 0;
+                    for (int y = 0; y &lt; shortAID.length; y = z) {
+                        shortListAID = new short[shortAID[y]];
+                        z = z + shortListAID.length + 3;
+                        for (int x = 0; x &lt; shortListAID.length; x++) {
+                            shortListAID[x] = shortAID[x + y + 1];
+                        }
+
+                        if ((shortAID[z - 1] &amp; (byte) 0x80) != 1) {
+                            boolean equals = (APPLET_AID.length == shortListAID.length);
+                            for (int j = 0; j &lt; shortListAID.length &amp;&amp; equals == true; j++) {
+                                if(APPLET_AID[j] != shortListAID[j])
+                                    equals = false;
+                            }
+                            if(!equals)
+                            {
+                                card.EndTransaction();
+                                card = null;
+                            }
+                        }
+                    }
+                    if(card != null)
+                        card.EndTransaction();
+                } catch (slbException e) {
+                    card = null;
+                }
+            } else
+                card = null;
+            i++;
+        }
+    }
+    
+    /**
+     * @param card
+     * @param LE
+     * @param body
+     * @param P2
+     * @param P1
+     * @param INS
+     * @param CLA
+     * @return out the result of the sendCardAPDU call
+     * @throws slbException
+     * 
+     */
+    public final static short[] sendCardAPDU(int CLA, int INS, int P1, int P2, int[] body, int LE) throws slbException,
+            SecurityException {
+        if (card == null)
+            throw new SecurityException(&quot;Pas de carte disponible !&quot;);
+
+        // Initialisation
+        card.BeginTransaction();
+        if (!card.SelectAID(AppletManager.APPLET_AID))
+            throw new SecurityException(&quot;Pas d'applet de cryptage !&quot;);
+        
+        short[] out = card.SendCardAPDU(CLA, INS, P1, P2, body, LE);
+        card.EndTransaction();
+        if (out == null)
+            out = new short[0];
+        return out;
+    }
+}
+

Added: trunk/src/de/berlios/jmds/server/UserManagerAppletClient.java
===================================================================
--- trunk/src/de/berlios/jmds/server/UserManagerAppletClient.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/src/de/berlios/jmds/server/UserManagerAppletClient.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -0,0 +1,60 @@
+/*
+ * Created on 1 mars 2005
+ * by J&#233;r&#244;me GUERS
+ * Copyright: GPL - UMLV(FR) - 2004/2005
+ */
+package de.berlios.jmds.server;
+
+import slb.iop.slbException;
+import de.berlios.jmds.common.AppletManager;
+import de.berlios.jmds.tools.Convertor;
+
+/**
+ * DOCME
+ * 
+ * @author J&#233;r&#244;me GUERS
+ */
+public class UserManagerAppletClient {
+
+    private final static byte CLA_SECURITY = (byte) 0x69;
+    private final static byte INS_SET_USER = (byte) 0x30;
+    private final static byte INS_SET_SERVERKEY_MOD = (byte) 0x44;
+    private final static byte INS_SET_SERVERKEY_EXP = (byte) 0x66;
+    
+    // ----------------------------------------------------------//
+    // ------------------- PUBLIC METHODS -----------------------//
+    // ----------------------------------------------------------//
+    /**
+     * @param userId
+     * 
+     * @return
+     * @throws slbException 
+     * @throws SecurityException 
+     */
+    public static void setUser(byte[] userId) throws SecurityException, slbException {
+        AppletManager.sendCardAPDU(CLA_SECURITY, INS_SET_USER, 0, 0, Convertor.byteArrayToIntArray(userId), 0);
+    }
+
+    /**
+     * @param userId
+     * 
+     * @return
+     * @throws slbException 
+     * @throws SecurityException 
+     */
+    public static void setServerKeyModulus(byte[] mod) throws SecurityException, slbException {
+        AppletManager.sendCardAPDU(CLA_SECURITY, INS_SET_SERVERKEY_MOD, 0, 0, Convertor.byteArrayToIntArray(mod), 0);
+    }
+
+    /**
+     * @param mod
+     * 
+     * @return
+     * @throws slbException 
+     * @throws SecurityException 
+     */
+    public static void setServerKeyExponent(byte[] exp) throws SecurityException, slbException {
+        AppletManager.sendCardAPDU(CLA_SECURITY, INS_SET_SERVERKEY_EXP, 0, 0, Convertor.byteArrayToIntArray(exp), 0);
+    }
+}
+

Modified: trunk/src/de/berlios/jmds/tools/Convertor.java
===================================================================
--- trunk/src/de/berlios/jmds/tools/Convertor.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/src/de/berlios/jmds/tools/Convertor.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -79,10 +79,10 @@
      * @param requestId
      * @return the table of int
      */
-    public final static int[] byteArrayToIntArray(byte[] requestId) {
-        int[] tmp = null;
-        for (int i = 0; i &lt; requestId.length; i++) {
-            tmp[i] = new Byte(requestId[i]).intValue();
+    public final static int[] byteArrayToIntArray(byte[] byteArray) {
+        int[] tmp = new int[byteArray.length];
+        for (int i = 0; i &lt; byteArray.length; i++) {
+            tmp[i] = byteArray[i];
         }
         return tmp;
     }

Modified: trunk/test/de/berlios/jmds/clients/TestSCApllet.java
===================================================================
--- trunk/test/de/berlios/jmds/clients/TestSCApllet.java	2005-03-01 11:11:22 UTC (rev 46)
+++ trunk/test/de/berlios/jmds/clients/TestSCApllet.java	2005-03-02 00:18:26 UTC (rev 47)
@@ -9,8 +9,24 @@
  */
 package de.berlios.jmds.clients;
 
+import java.security.InvalidKeyException;
+import java.security.Key;
+import java.security.KeyPair;
+import java.security.KeyPairGenerator;
+import java.security.NoSuchAlgorithmException;
+import java.security.NoSuchProviderException;
+import java.security.interfaces.RSAPublicKey;
+
+import javax.crypto.BadPaddingException;
+import javax.crypto.Cipher;
+import javax.crypto.IllegalBlockSizeException;
+import javax.crypto.NoSuchPaddingException;
+import javax.crypto.ShortBufferException;
+
+
 import slb.iop.slbException;
 import de.berlios.jmds.client.SCAppletClient;
+import de.berlios.jmds.server.UserManagerAppletClient;
 import de.berlios.jmds.tools.Convertor;
 
 /**
@@ -20,14 +36,28 @@
  */
 public class TestSCApllet{
 
-    public static void main(String[] args) {
-        SCAppletClient appletClient = SCAppletClient.getInstance();
+    public static void main(String[] args) throws NoSuchAlgorithmException, SecurityException, slbException, NoSuchPaddingException, InvalidKeyException, ShortBufferException, IllegalBlockSizeException, BadPaddingException, NoSuchProviderException {
+        KeyPair keyPair = KeyPairGenerator.getInstance(&quot;RSA&quot;).generateKeyPair();
         
-        byte[] code = {(short)0x55, (short)0x55,(short)0x55,(short)0x55,(short)0x55,};
+        RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();
+        Key privateKey = keyPair.getPrivate();
         
+        UserManagerAppletClient.setUser(&quot;jmds&quot;.getBytes());
+        UserManagerAppletClient.setServerKeyModulus(publicKey.getModulus().toByteArray());
+        UserManagerAppletClient.setServerKeyExponent(publicKey.getPublicExponent().toByteArray());
+        
+        byte[] code = {(short)0x55, (short)0x55,(short)0x55,(short)0x55,(short)0x55};
+        
         try {
-            code = appletClient.code(code);
+            code = SCAppletClient.code(code);
+            
             System.out.println(Convertor.ByteArrayToSpacedHexString(code));
+            
+            Cipher cipher = Cipher.getInstance(&quot;RSA/ECB/PKCS1Padding&quot;, &quot;BC&quot;);
+            cipher.init(Cipher.DECRYPT_MODE, privateKey);
+            cipher.doFinal(code, (short)0, (short) code.length, code, (short)0);
+
+            System.out.println(Convertor.ByteArrayToSpacedHexString(code));
         } catch (SecurityException e) {
             e.printStackTrace();
         } catch (slbException e) {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000059.html">[Jmds-svn] r46 - in trunk: applet/de/berlios/jmds/applet/javacard src/de/berlios/jmds/applet src/de/berlios/jmds/client src/de/berlios/jmds/tools test/de/berlios/jmds/clients
</A></li>
	<LI>Next message: <A HREF="000061.html">[Jmds-svn] Applet fini, mais c'est le d&#233;sert en dehors de la carte !!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#60">[ date ]</a>
              <a href="thread.html#60">[ thread ]</a>
              <a href="subject.html#60">[ subject ]</a>
              <a href="author.html#60">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/jmds-svn">More information about the Jmds-svn
mailing list</a><br>
</body></html>
