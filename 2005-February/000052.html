<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Jmds-svn] r39 - in members/jguers: . TestCard TestCard/.settings TestCard/applets TestCard/applets/de TestCard/applets/de/berlios TestCard/applets/de/berlios/jmds TestCard/applets/de/berlios/jmds/test TestCard/applets/de/berlios/jmds/test/javacard TestCard/generator TestCard/src TestCard/src/de TestCard/src/de/berlios TestCard/src/de/berlios/jmds TestCard/src/de/berlios/jmds/test TestCard/src/de/berlios/jmds/test/clients TestCard/src/de/berlios/jmds/tools
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/jmds-svn/2005-February/index.html" >
   <LINK REL="made" HREF="mailto:jmds-svn%40lists.berlios.de?Subject=Re%3A%20%5BJmds-svn%5D%20r39%20-%20in%20members/jguers%3A%20.%20TestCard%20TestCard/.settings%20TestCard/applets%20TestCard/applets/de%20TestCard/applets/de/berlios%20TestCard/applets/de/berlios/jmds%20TestCard/applets/de/berlios/jmds/test%20TestCard/applets/de/berlios/jmds/test/javacard%20TestCard/generator%20TestCard/src%20TestCard/src/de%20TestCard/src/de/berlios%20TestCard/src/de/berlios/jmds%20TestCard/src/de/berlios/jmds/test%20TestCard/src/de/berlios/jmds/test/clients%20TestCard/src/de/berlios/jmds/tools&In-Reply-To=%3C200502250016.j1P0G8CO018531%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000051.html">
   <LINK REL="Next"  HREF="000053.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Jmds-svn] r39 - in members/jguers: . TestCard TestCard/.settings TestCard/applets TestCard/applets/de TestCard/applets/de/berlios TestCard/applets/de/berlios/jmds TestCard/applets/de/berlios/jmds/test TestCard/applets/de/berlios/jmds/test/javacard TestCard/generator TestCard/src TestCard/src/de TestCard/src/de/berlios TestCard/src/de/berlios/jmds TestCard/src/de/berlios/jmds/test TestCard/src/de/berlios/jmds/test/clients TestCard/src/de/berlios/jmds/tools</H1>
    <B>J&#233;r&#244;me GUERS at BerliOS</B> 
    <A HREF="mailto:jmds-svn%40lists.berlios.de?Subject=Re%3A%20%5BJmds-svn%5D%20r39%20-%20in%20members/jguers%3A%20.%20TestCard%20TestCard/.settings%20TestCard/applets%20TestCard/applets/de%20TestCard/applets/de/berlios%20TestCard/applets/de/berlios/jmds%20TestCard/applets/de/berlios/jmds/test%20TestCard/applets/de/berlios/jmds/test/javacard%20TestCard/generator%20TestCard/src%20TestCard/src/de%20TestCard/src/de/berlios%20TestCard/src/de/berlios/jmds%20TestCard/src/de/berlios/jmds/test%20TestCard/src/de/berlios/jmds/test/clients%20TestCard/src/de/berlios/jmds/tools&In-Reply-To=%3C200502250016.j1P0G8CO018531%40sheep.berlios.de%3E"
       TITLE="[Jmds-svn] r39 - in members/jguers: . TestCard TestCard/.settings TestCard/applets TestCard/applets/de TestCard/applets/de/berlios TestCard/applets/de/berlios/jmds TestCard/applets/de/berlios/jmds/test TestCard/applets/de/berlios/jmds/test/javacard TestCard/generator TestCard/src TestCard/src/de TestCard/src/de/berlios TestCard/src/de/berlios/jmds TestCard/src/de/berlios/jmds/test TestCard/src/de/berlios/jmds/test/clients TestCard/src/de/berlios/jmds/tools">jguers at sheep.berlios.de
       </A><BR>
    <I>Fri Feb 25 01:16:08 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000051.html">[Jmds-svn] r38 - in trunk/src: de/berlios/jmds/server fr/umlv/ir3/corba/forum
</A></li>
        <LI>Next message: <A HREF="000053.html">[Jmds-svn] r40 - in trunk/src: . fr/umlv/ir3/corba/forum
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52">[ date ]</a>
              <a href="thread.html#52">[ thread ]</a>
              <a href="subject.html#52">[ subject ]</a>
              <a href="author.html#52">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: jguers
Date: 2005-02-25 01:15:44 +0100 (Fri, 25 Feb 2005)
New Revision: 39

Added:
   members/jguers/TestCard/
   members/jguers/TestCard/.classpath
   members/jguers/TestCard/.project
   members/jguers/TestCard/.settings/
   members/jguers/TestCard/.settings/org.eclipse.jdt.core.prefs
   members/jguers/TestCard/applets/
   members/jguers/TestCard/applets/de/
   members/jguers/TestCard/applets/de/berlios/
   members/jguers/TestCard/applets/de/berlios/jmds/
   members/jguers/TestCard/applets/de/berlios/jmds/test/
   members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/
   members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.ijc
   members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.jar
   members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.jca
   members/jguers/TestCard/generator/
   members/jguers/TestCard/generator/ping.pmf
   members/jguers/TestCard/ping.fcn
   members/jguers/TestCard/src/
   members/jguers/TestCard/src/de/
   members/jguers/TestCard/src/de/berlios/
   members/jguers/TestCard/src/de/berlios/jmds/
   members/jguers/TestCard/src/de/berlios/jmds/test/
   members/jguers/TestCard/src/de/berlios/jmds/test/Ping.java
   members/jguers/TestCard/src/de/berlios/jmds/test/clients/
   members/jguers/TestCard/src/de/berlios/jmds/test/clients/ClientPing.java
   members/jguers/TestCard/src/de/berlios/jmds/tools/
   members/jguers/TestCard/src/de/berlios/jmds/tools/Convertor.java
Log:
Retour a ma version de test...


Property changes on: members/jguers/TestCard
___________________________________________________________________
Name: svn:ignore
   + classes
doc


Added: members/jguers/TestCard/.classpath
===================================================================
--- members/jguers/TestCard/.classpath	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/.classpath	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,8 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;classpath&gt;
+	&lt;classpathentry kind=&quot;src&quot; path=&quot;src&quot;/&gt;
+	&lt;classpathentry kind=&quot;con&quot; path=&quot;org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JRE 1.3&quot;/&gt;
+	&lt;classpathentry kind=&quot;lib&quot; path=&quot;C:/Program Files/Java/java_card_kit-2_2_1/lib/javacardframework.jar&quot;/&gt;
+	&lt;classpathentry kind=&quot;lib&quot; path=&quot;C:/Program Files/Schlumberger/Smart Cards and Terminals/Cyberflex Access Kits/v4/Middleware Interfaces/jiop/slbJIop.jar&quot;/&gt;
+	&lt;classpathentry kind=&quot;output&quot; path=&quot;classes&quot;/&gt;
+&lt;/classpath&gt;

Added: members/jguers/TestCard/.project
===================================================================
--- members/jguers/TestCard/.project	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/.project	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,17 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;projectDescription&gt;
+	&lt;name&gt;TestCard&lt;/name&gt;
+	&lt;comment&gt;&lt;/comment&gt;
+	&lt;projects&gt;
+	&lt;/projects&gt;
+	&lt;buildSpec&gt;
+		&lt;buildCommand&gt;
+			&lt;name&gt;org.eclipse.jdt.core.javabuilder&lt;/name&gt;
+			&lt;arguments&gt;
+			&lt;/arguments&gt;
+		&lt;/buildCommand&gt;
+	&lt;/buildSpec&gt;
+	&lt;natures&gt;
+		&lt;nature&gt;org.eclipse.jdt.core.javanature&lt;/nature&gt;
+	&lt;/natures&gt;
+&lt;/projectDescription&gt;

Added: members/jguers/TestCard/.settings/org.eclipse.jdt.core.prefs
===================================================================
--- members/jguers/TestCard/.settings/org.eclipse.jdt.core.prefs	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/.settings/org.eclipse.jdt.core.prefs	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,12 @@
+#Tue Feb 08 22:15:09 CET 2005
+org.eclipse.jdt.core.compiler.debug.localVariable=generate
+org.eclipse.jdt.core.compiler.compliance=1.3
+org.eclipse.jdt.core.compiler.codegen.unusedLocal=preserve
+org.eclipse.jdt.core.compiler.debug.sourceFile=generate
+org.eclipse.jdt.core.compiler.codegen.targetPlatform=1.1
+org.eclipse.jdt.core.compiler.problem.enumIdentifier=ignore
+eclipse.preferences.version=1
+org.eclipse.jdt.core.compiler.debug.lineNumber=generate
+org.eclipse.jdt.core.compiler.codegen.inlineJsrBytecode=enabled
+org.eclipse.jdt.core.compiler.source=1.3
+org.eclipse.jdt.core.compiler.problem.assertIdentifier=ignore

Added: members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.ijc
===================================================================
(Binary files differ)


Property changes on: members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.ijc
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.jar
===================================================================
(Binary files differ)


Property changes on: members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.jca
===================================================================
--- members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.jca	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/applets/de/berlios/jmds/test/javacard/test.jca	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,159 @@
+// converted by version 1.3
+// on Fri Feb 25 00:46:14 CET 2005
+
+.package de/berlios/jmds/test {
+	.aid 0x11:0x22:0x33:0x44:0x55:0x66;
+	.version 1.0;
+
+	.imports {
+		0xA0:0x0:0x0:0x0:0x62:0x1:0x1 1.0;		//javacard/framework
+	}
+
+	.applet {
+		0x11:0x22:0x33:0x44:0x55:0x66:0x77 Ping;
+	}
+
+	.constantPool {
+		// 0
+		instanceFieldRef byte[] Ping/buffer;
+		// 1
+		instanceFieldRef byte Ping/messLength;
+		// 2
+		staticMethodRef 0.3.0()V;		// javacard/framework/Applet.&lt;init&gt;()V
+		// 3
+		virtualMethodRef 0.3.1()V;		// javacard/framework/Applet.register()V
+		// 4
+		classRef Ping;
+		// 5
+		staticMethodRef Ping/&lt;init&gt;()V;
+		// 6
+		virtualMethodRef 0.10.1()[B;		// javacard/framework/APDU.getBuffer()[B
+		// 7
+		virtualMethodRef 0.10.6()S;		// javacard/framework/APDU.setIncomingAndReceive()S
+		// 8
+		virtualMethodRef 0.10.7()S;		// javacard/framework/APDU.setOutgoing()S
+		// 9
+		staticMethodRef 0.7.1(S)V;		// javacard/framework/ISOException.throwIt(S)V
+		// 10
+		virtualMethodRef 0.10.9(S)V;		// javacard/framework/APDU.setOutgoingLength(S)V
+		// 11
+		virtualMethodRef 0.10.5([BSS)V;		// javacard/framework/APDU.sendBytesLong([BSS)V
+	}
+
+	.class public Ping 0 extends 0.3 {		// extends javacard/framework/Applet
+
+		.fields {
+			private byte[] buffer 0;		// [B
+			private byte messLength 1;		// B
+			private static final byte CLA_PING = -128;		// B
+			private static final byte ECHO_REQUEST = 16;		// B
+			private static final byte ECHO_REPLY = 48;		// B
+			private static final short BUFFER_LENGTH = 255;		// S
+		}
+
+		.publicMethodTable 7 {
+			equals(Ljava/lang/Object;)Z;
+			register()V;
+			register([BSB)V;
+			selectingApplet()Z;
+			deselect()V;
+			getShareableInterfaceObject(Ljavacard/framework/AID;B)Ljavacard/framework/Shareable;;
+			select()Z;
+			process(Ljavacard/framework/APDU;)V;
+		}
+
+		.packageMethodTable 0 {
+		}
+
+		.method protected &lt;init&gt;()V 0 {
+			.stack 2;
+			.locals 0;
+
+				L0:	aload_0;
+					invokespecial 2;		// javacard/framework/Applet.&lt;init&gt;()V
+					aload_0;
+					sspush 255;
+					newarray 11;
+					putfield_a 0;		// reference de/berlios/jmds/test/Ping.buffer
+					aload_0;
+					sconst_0;
+					putfield_b 1;		// byte de/berlios/jmds/test/Ping.messLength
+					aload_0;
+					invokevirtual 3;		// javacard/framework/Applet.register()V
+					return;
+		}
+
+		.method public static install([BSB)V 1 {
+			.stack 1;
+			.locals 0;
+
+				L0:	new 4;		// de/berlios/jmds/test/Ping
+					invokespecial 5;		// de/berlios/jmds/test/Ping.&lt;init&gt;()V
+					return;
+		}
+
+		.method public process(Ljavacard/framework/APDU;)V 7 {
+			.stack 5;
+			.locals 2;
+
+			.descriptor	Ljavacard/framework/APDU;	0.10;
+
+				L0:	aload_1;
+					invokevirtual 6;		// javacard/framework/APDU.getBuffer()[B
+					astore_2;
+					aload_2;
+					sconst_0;
+					baload;
+					bspush -128;
+					if_scmpne L9;
+				L1:	aload_2;
+					sconst_1;
+					baload;
+					slookupswitch L9 2 16 L2 48 L6;
+				L2:	aload_0;
+					aload_1;
+					invokevirtual 7;		// javacard/framework/APDU.setIncomingAndReceive()S
+					s2b;
+					putfield_b 1;		// byte de/berlios/jmds/test/Ping.messLength
+					sconst_0;
+					sstore_3;
+					goto L4;
+				L3:	getfield_a_this 0;		// reference de/berlios/jmds/test/Ping.buffer
+					sload_3;
+					aload_2;
+					sconst_5;
+					sload_3;
+					sadd;
+					baload;
+					bastore;
+					sload_3;
+					sconst_1;
+					sadd;
+					s2b;
+					sstore_3;
+				L4:	sload_3;
+					getfield_b_this 1;		// byte de/berlios/jmds/test/Ping.messLength
+					if_scmplt L3;
+				L5:	goto L9;
+				L6:	aload_1;
+					invokevirtual 8;		// javacard/framework/APDU.setOutgoing()S
+					sstore_3;
+					sload_3;
+					getfield_b_this 1;		// byte de/berlios/jmds/test/Ping.messLength
+					if_scmpge L8;
+				L7:	sspush 26368;
+					invokestatic 9;		// javacard/framework/ISOException.throwIt(S)V
+				L8:	aload_1;
+					getfield_b_this 1;		// byte de/berlios/jmds/test/Ping.messLength
+					invokevirtual 10;		// javacard/framework/APDU.setOutgoingLength(S)V
+					aload_1;
+					getfield_a_this 0;		// reference de/berlios/jmds/test/Ping.buffer
+					sconst_0;
+					getfield_b_this 1;		// byte de/berlios/jmds/test/Ping.messLength
+					invokevirtual 11;		// javacard/framework/APDU.sendBytesLong([BSS)V
+				L9:	return;
+		}
+
+	}
+
+}

Added: members/jguers/TestCard/generator/ping.pmf
===================================================================
--- members/jguers/TestCard/generator/ping.pmf	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/generator/ping.pmf	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,11 @@
+[PrgMaker]
+Package=de.berlios.jmds.test
+PackageAID=112233445566
+OutputDir=d:\1G2K - SOPRA\IR3\Corba\jmds\SVN\members\jguers\TestCard\applets
+ExportDir=c:\Program Files\Schlumberger\Smart Cards and Terminals\Cyberflex Access Kits\v4\Toolkit\PRGMaker\Export Files
+Version=1.0
+ClassDir=d:\1G2K - SOPRA\IR3\Corba\jmds\SVN\members\jguers\TestCard\classes
+[Applets]
+NumApplets=1
+Applet1=Ping.class
+Applet1AID=11223344556677

Added: members/jguers/TestCard/ping.fcn
===================================================================
--- members/jguers/TestCard/ping.fcn	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/ping.fcn	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,2 @@
+&quot;Echo Reply&quot;,&quot;8030000003&quot;,#FALSE#
+&quot;Echo Request&quot;,&quot;8010000003101020&quot;,#TRUE#

Added: members/jguers/TestCard/src/de/berlios/jmds/test/Ping.java
===================================================================
--- members/jguers/TestCard/src/de/berlios/jmds/test/Ping.java	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/src/de/berlios/jmds/test/Ping.java	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,79 @@
+/*
+ * Created on 8 f&#233;vr. 2005
+ * by J&#233;r&#244;me GUERS
+ * Copyright: GPL - UMLV(FR) - 2004/2005
+ */
+package de.berlios.jmds.test;
+
+import javacard.framework.APDU;
+import javacard.framework.Applet;
+import javacard.framework.ISOException;
+import javacard.framework.ISO7816;
+
+/**
+ * Premi&#232;re classe de test d'une applet JavaCard Renvoie juste les donn&#233;es
+ * envoy&#233;es
+ * 
+ * @version 0.1
+ * 
+ * @author J&#233;r&#244;me GUERS
+ */
+public class Ping extends Applet {
+
+    private final static byte CLA_PING = (byte) 0x80;
+    private final static byte ECHO_REQUEST = (byte) 0x10;
+    private final static byte ECHO_REPLY = (byte) 0x30;
+    private final static short BUFFER_LENGTH = (short) 255;
+
+    private byte[] buffer;
+    private byte messLength;
+
+    /**
+     * Constructeur par d&#233;faut
+     */
+    protected Ping() {
+        buffer = new byte[BUFFER_LENGTH];
+        messLength = (byte) 0;
+        register();
+    }
+
+    public static void install(byte[] bArray, short bOffset, byte bLength) {
+        new Ping();
+    }
+
+    /**
+     * M&#233;thide appel&#233;e &#224; l'arriv&#233;e d'une trame APDU
+     * 
+     * @param arg0
+     * @throws ISOException
+     * 
+     * @see javacard.framework.Applet#process(javacard.framework.APDU)
+     */
+    public void process(APDU apdu) throws ISOException {
+        byte[] tmpBuffer = apdu.getBuffer();
+
+        // CLA &#224; 0x80
+        if (tmpBuffer[ISO7816.OFFSET_CLA] == CLA_PING) {
+            switch (tmpBuffer[ISO7816.OFFSET_INS]) {
+            case ECHO_REQUEST:
+                messLength = (byte)(apdu.setIncomingAndReceive());
+//                if ((byteRead &gt; (byte) BUFFER_LENGTH) || (byteRead &lt;= (byte) 0))
+//                    ISOException.throwIt(ISO7816.SW_WRONG_DATA);
+                for (byte i = (byte) 0; i &lt; messLength; i++) {
+                    buffer[i] = tmpBuffer[ISO7816.OFFSET_CDATA + i];
+                }
+                break;
+
+            case ECHO_REPLY:
+                // Le = taille de la r&#233;ponse attendue
+                short Le = apdu.setOutgoing();
+                // Verification que Le &gt;= Lc (taille des donn&#233;es envoy&#233;es)
+                if (Le &lt; messLength)
+                    ISOException.throwIt(ISO7816.SW_WRONG_LENGTH);
+                apdu.setOutgoingLength((short) messLength);
+                apdu.sendBytesLong(buffer, (short) 0, (short) messLength);
+                break;
+            }
+        }
+    }
+}

Added: members/jguers/TestCard/src/de/berlios/jmds/test/clients/ClientPing.java
===================================================================
--- members/jguers/TestCard/src/de/berlios/jmds/test/clients/ClientPing.java	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/src/de/berlios/jmds/test/clients/ClientPing.java	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,144 @@
+/*
+ * Created on 9 f&#233;vr. 2005
+ * by J&#233;r&#244;me GUERS
+ * Copyright: GPL - UMLV(FR) - 2004/2005
+ */
+package de.berlios.jmds.test.clients;
+
+import de.berlios.jmds.tools.Convertor;
+import slb.iop.*;
+
+/**
+ * Teste la classe Ping charg&#233;e sur la carte
+ * 
+ * @version 0.1
+ * 
+ * @author J&#233;r&#244;me GUERS
+ */
+public class ClientPing {
+
+    private static class jmdsIOPListener implements IOPListener {
+
+        /**
+         * DOCME
+         * 
+         * @param arg0
+         * 
+         * @see slb.iop.IOPListener#CardRemoved(slb.iop.IOPEvent)
+         */
+        public void CardRemoved(IOPEvent event) {
+            System.out.println(&quot;Carte retir&#233;e de &quot;);
+            System.out.println(event.getReaderName());
+        }
+
+        /**
+         * DOCME
+         * 
+         * @param arg0
+         * 
+         * @see slb.iop.IOPListener#CardInserted(slb.iop.IOPEvent)
+         */
+        public void CardInserted(IOPEvent event) {
+            System.out.print(&quot;Carte ins&#233;r&#233;e dans &quot;);
+            System.out.println(event.getReaderName());
+        }
+
+        /**
+         * DOCME
+         * 
+         * @param arg0
+         * 
+         * @see slb.iop.IOPListener#ReaderRemoved(slb.iop.IOPEvent)
+         */
+        public void ReaderRemoved(IOPEvent event) {
+            System.out.println(&quot;Lecteur d&#233;connect&#233;&quot;);
+        }
+
+        /**
+         * DOCME
+         * 
+         * @param arg0
+         * 
+         * @see slb.iop.IOPListener#ReaderInserted(slb.iop.IOPEvent)
+         */
+        public void ReaderInserted(IOPEvent event) {
+            System.out.println(&quot;Lecteur connect&#233;&quot;);
+        }
+    }
+
+    public static void main(String[] args) {
+        IOP sIOP = new IOP();
+
+        jmdsIOPListener listener = new jmdsIOPListener();
+        sIOP.addIOPListener(listener);
+
+        String[] lstReaders = sIOP.ListReaders();
+
+        for (int i = 0; i &lt; lstReaders.length; i++) {
+            System.out.println(lstReaders[i]);
+        }
+
+        SmartCard card = new SmartCard();
+        if (lstReaders.length &gt; 0) {
+            boolean result = sIOP.Connect(card, lstReaders[0], false);
+            if (result) {
+                System.out.println(&quot;Carte connectee&quot;);
+
+                int CLA = Integer.parseInt(&quot;00&quot;, 16);
+                int INS = Integer.parseInt(&quot;A4&quot;, 16);
+                int P1 = Integer.parseInt(&quot;04&quot;, 16);
+                int P2 = Integer.parseInt(&quot;00&quot;, 16);
+                int[] body = Convertor.stringToIntArray(&quot;11223344556677&quot;);
+                int LE = Integer.parseInt(&quot;00&quot;, 16);
+                try {
+                    System.out.println(&quot;Applet Selection&quot;);
+                    card.BeginTransaction();
+                    card.SendCardAPDU(CLA, INS, P1, P2, body, LE);
+                    System.out.println(&quot;Applet selected&quot;);
+                    card.EndTransaction();
+                } catch (slb.iop.slbException e) {
+                    System.out.println(&quot;Pb de Selection&quot;);
+                    e.printStackTrace();
+                }
+
+                System.out.println(&quot;Envoi de l'APDU Echo Request&quot;);
+                CLA = Integer.parseInt(&quot;80&quot;, 16);
+                INS = Integer.parseInt(&quot;10&quot;, 16);
+                P1 = Integer.parseInt(&quot;00&quot;, 16);
+                P2 = Integer.parseInt(&quot;00&quot;, 16);
+                body = Convertor.stringToIntArray(&quot;102030&quot;);
+                LE = Integer.parseInt(&quot;00&quot;, 16);
+
+                try {
+                    card.BeginTransaction();
+                    card.SendCardAPDU(CLA, INS, P1, P2, body, LE);
+                    card.EndTransaction();
+                } catch (slb.iop.slbException e) {
+                    System.out.println(&quot;Erreur request&quot;);
+                    e.printStackTrace();
+                }
+
+                System.out.print(&quot;Envoi de l'APDU Echo Reply: &gt; &quot;);
+                CLA = (int) Integer.parseInt(&quot;80&quot;, 16);
+                INS = (int) Integer.parseInt(&quot;30&quot;, 16);
+                P1 = (int) Integer.parseInt(&quot;00&quot;, 16);
+                P2 = (int) Integer.parseInt(&quot;00&quot;, 16);
+                body = Convertor.stringToIntArray(&quot;&quot;);
+                LE = (int) Integer.parseInt(&quot;03&quot;, 16);
+
+                try {
+                    card.BeginTransaction();
+                    short[] out = card.SendCardAPDU(CLA, INS, P1, P2, body, LE);
+                    for (int i = 0; i &lt; out.length; i++) {
+                        System.out.print(Integer.toHexString(out[i]) + &quot; &quot;);
+                    }
+                    System.out.println(&quot;&quot;);
+                    card.EndTransaction();
+                } catch (slb.iop.slbException e) {
+                    System.out.println(&quot;Erreur reply&quot;);
+                    e.printStackTrace();
+                }
+            }
+        }
+    }
+}

Added: members/jguers/TestCard/src/de/berlios/jmds/tools/Convertor.java
===================================================================
--- members/jguers/TestCard/src/de/berlios/jmds/tools/Convertor.java	2005-02-25 00:10:58 UTC (rev 38)
+++ members/jguers/TestCard/src/de/berlios/jmds/tools/Convertor.java	2005-02-25 00:15:44 UTC (rev 39)
@@ -0,0 +1,66 @@
+/*
+ * Created on 9 f&#233;vr. 2005
+ * by J&#233;r&#244;me GUERS
+ * Copyright: GPL - UMLV(FR) - 2004/2005
+ */
+package de.berlios.jmds.tools;
+
+/**
+ * Permet la conversion de String en short[] et inversement
+ * 
+ * @version 0.1
+ * 
+ * @author J&#233;r&#244;me GUERS
+ */
+public class Convertor {
+    
+    /**
+     * DOCME
+     */
+    public final static short[] stringToShortArray(String value) {
+        short shortKey[] = new short[(value.length() / 2)];
+        int y = 0;
+        String strShort;
+
+        for (int x = 0; x &lt; shortKey.length; x++) {
+            strShort = value.substring(y, (y + 2));
+            if (strShort.equals(&quot;FF&quot;)) {
+                shortKey[x] = (short) 0xFF;
+            } else {
+                try {
+                    shortKey[x] = (short) Short.parseShort(strShort, 16);
+                } catch (NumberFormatException e) {
+                    System.out.println(&quot;HexStringToShortArray Failed &quot;);
+                }
+            }
+            y = y + 2;
+        }
+        return shortKey;
+    }
+    
+    /**
+     * DOCME
+     */
+    public static int[] stringToIntArray(String value) {
+        int intKey[] = new int[(value.length() / 2)];
+        int y = 0;
+        String strInt;
+
+        for (int x = 0; x &lt; intKey.length; x++) {
+            strInt = value.substring(y, (y + 2));
+            if (strInt.equals(&quot;FF&quot;)) {
+                intKey[x] = (int) 0xFF;
+            } else {
+                try {
+                    intKey[x] = (int) Integer.parseInt(strInt, 16);
+                } catch (NumberFormatException e) {
+                    System.out.println(&quot;stringToShortArray Failed &quot;);
+                }
+            }
+
+            y = y + 2;
+        }
+        return intKey;
+    }
+}
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000051.html">[Jmds-svn] r38 - in trunk/src: de/berlios/jmds/server fr/umlv/ir3/corba/forum
</A></li>
	<LI>Next message: <A HREF="000053.html">[Jmds-svn] r40 - in trunk/src: . fr/umlv/ir3/corba/forum
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52">[ date ]</a>
              <a href="thread.html#52">[ thread ]</a>
              <a href="subject.html#52">[ subject ]</a>
              <a href="author.html#52">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/jmds-svn">More information about the Jmds-svn
mailing list</a><br>
</body></html>
